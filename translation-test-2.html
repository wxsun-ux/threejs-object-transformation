<html lang="en">
<head>
  <title> --- 任务 --- </title>
  <meta charset="UTF-8">
  <script type="text/javascript" src="js/three.min.js"></script>
  <script type="text/javascript" src="js/OrbitControls.js"></script>
  <script type="text/javascript" src="js/three-freeform-controls.umd.js"></script>
  <link rel="stylesheet" type="text/css" href="css/style.css"/>
</head>
<body>
    <div class="block" id="block"></div>

    <div class="container">
        <span class="min" id="dd">20</span><span class="sen">s</span>
        <input type="button" value="开始"  onclick="start()" class="btn" id="timesum" />
    </div>

    <script>

        // add renderer
        var renderer = new THREE.WebGLRenderer({
            antialias: true
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // add scene
        var scene = new THREE.Scene();

        // set camera
        var camera =  new THREE.PerspectiveCamera(
            70,
            window.innerWidth / window.innerHeight,
            0.1,
            10000
        );
        camera.position.set(-5, 3, 0);
        camera.lookAt(new THREE.Vector3(0, 0, 0));

        // set light
        var point = new THREE.PointLight(0xffffff);
        point.position.set(40, 20, 30); 
        scene.add(point); 
        var ambient = new THREE.AmbientLight(0x444444);
        scene.add(ambient);

        // set plane helper
        var gridHelper = new THREE.GridHelper(100, 100, 0x333333, 0x333333);
        gridHelper.position.y -= 2;
        scene.add(gridHelper);

        // add box 
        var boxGeometry = new THREE.BoxGeometry(1,1,1);
        var boxMaterial = [
            new THREE.MeshBasicMaterial({color:0xffffff}),
            new THREE.MeshBasicMaterial({color:0xf6f05e}),
            new THREE.MeshBasicMaterial({color:0x82c892}),
            new THREE.MeshBasicMaterial({color:0x7fd1dd}),
            new THREE.MeshBasicMaterial({color:0xf79361}),
            new THREE.MeshBasicMaterial({color:0xcb79ff})
        ];
        var boxMesh = new THREE.Mesh( boxGeometry, boxMaterial );
        boxMesh.position.set(0, 0, 0);
        scene.add(boxMesh);

        var boxGeometry_target = new THREE.BoxGeometry(1,1,1);
        var boxMaterial_target = [
            new THREE.MeshBasicMaterial({color:0xffffff, transparent: true, opacity: 0.5}),
            new THREE.MeshBasicMaterial({color:0xf6f05e, transparent: true, opacity: 0.5}),
            new THREE.MeshBasicMaterial({color:0x82c892, transparent: true, opacity: 0.5}),
            new THREE.MeshBasicMaterial({color:0x7fd1dd, transparent: true, opacity: 0.5}),
            new THREE.MeshBasicMaterial({color:0xf79361, transparent: true, opacity: 0.5}),
            new THREE.MeshBasicMaterial({color:0xcb79ff, transparent: true, opacity: 0.5})
        ];
        var boxMesh_target = new THREE.Mesh( boxGeometry_target, boxMaterial_target );
        boxMesh_target.position.set(4, 2, 3);
        scene.add(boxMesh_target);
        
        // add octahedron
        var octahedronGeometry = new THREE.OctahedronGeometry(1,0);
        octahedronGeometry.faces[0].color.setHex( 0x808080 );
        octahedronGeometry.faces[1].color.setHex( 0xf26d64 );
        octahedronGeometry.faces[2].color.setHex( 0xcb79ff );
        octahedronGeometry.faces[3].color.setHex( 0xf79361 );
        octahedronGeometry.faces[4].color.setHex( 0x7fd1dd );
        octahedronGeometry.faces[5].color.setHex( 0x82c892 );
        octahedronGeometry.faces[6].color.setHex( 0xf6f05e );
        octahedronGeometry.faces[7].color.setHex( 0xffffff );
        var octahedronMaterial = new THREE.MeshBasicMaterial({
            vertexColors: THREE.FaceColors
        });

        var octahedronMesh = new THREE.Mesh( octahedronGeometry, octahedronMaterial );
        octahedronMesh.position.set(0, 0, 5);
        scene.add(octahedronMesh);

        var octahedronGeometry_target = new THREE.OctahedronGeometry(1,0);
        octahedronGeometry_target.faces[0].color.setHex( 0x808080 );
        octahedronGeometry_target.faces[1].color.setHex( 0xf26d64 );
        octahedronGeometry_target.faces[2].color.setHex( 0xcb79ff );
        octahedronGeometry_target.faces[3].color.setHex( 0xf79361 );
        octahedronGeometry_target.faces[4].color.setHex( 0x7fd1dd );
        octahedronGeometry_target.faces[5].color.setHex( 0x82c892 );
        octahedronGeometry_target.faces[6].color.setHex( 0xf6f05e );
        octahedronGeometry_target.faces[7].color.setHex( 0xffffff );
        var octahedronMaterial_target = new THREE.MeshBasicMaterial({
            vertexColors: THREE.FaceColors,
            transparent: true,
            opacity: 0.5
        });

        var octahedronMesh_target = new THREE.Mesh( octahedronGeometry_target, octahedronMaterial_target );
        octahedronMesh_target.position.set(5, 2, 7);
        scene.add(octahedronMesh_target);

        // add tetrahedron
        var tetrahedronGeometry = new THREE.TetrahedronGeometry( 1, 0 );
        tetrahedronGeometry.faces[0].color.setHex( 0x7fd1dd );
        tetrahedronGeometry.faces[1].color.setHex( 0x82c892 );
        tetrahedronGeometry.faces[2].color.setHex( 0xf6f05e );
        tetrahedronGeometry.faces[3].color.setHex( 0xcb79ff );
        
        var tetrahedronMaterial = new THREE.MeshBasicMaterial({
            vertexColors: THREE.FaceColors
        });

        var tetrahedronMesh = new THREE.Mesh( tetrahedronGeometry, tetrahedronMaterial );
        tetrahedronMesh.position.set(0, 0, -5);
        scene.add(tetrahedronMesh);

        var tetrahedronGeometry_target = new THREE.TetrahedronGeometry( 1, 0 );
        tetrahedronGeometry_target.faces[0].color.setHex( 0x7fd1dd );
        tetrahedronGeometry_target.faces[1].color.setHex( 0x82c892 );
        tetrahedronGeometry_target.faces[2].color.setHex( 0xf6f05e );
        tetrahedronGeometry_target.faces[3].color.setHex( 0xcb79ff );
        
        var tetrahedronMaterial_target = new THREE.MeshBasicMaterial({
            vertexColors: THREE.FaceColors,
            transparent: true,
            opacity: 0.5
        });

        var tetrahedronMesh_target = new THREE.Mesh( tetrahedronGeometry_target, tetrahedronMaterial_target );
        tetrahedronMesh_target.position.set(6, 2, -4);
        scene.add(tetrahedronMesh_target);

        // add orbit controls
        var orbitControls = new THREE.OrbitControls(camera, renderer.domElement);
        orbitControls.minDistance = 5;
        orbitControls.maxDistance = 20;

        // render
        function animate() {
            requestAnimationFrame(animate);
            orbitControls.update();
            renderer.render(scene, camera);
        }
        animate();

        // resize listener
        addEventListener('resize', onWindowResize, false);
        function onWindowResize(){
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // <!-- three-freeform-controls -->

        // initialize three-freeform-controls
        const controlsManager = new FreeformControls.ControlsManager(camera, renderer.domElement);
        scene.add(controlsManager);

        // anchor controls to the box
        const controls_box = controlsManager.anchor(boxMesh, {
            hideOtherHandlesOnDrag: false,
            showHelperPlane: false
        });

        controls_box.showAll(false);
        controls_box.showByNames(
            [
            FreeformControls.DEFAULT_HANDLE_GROUP_NAME.PICK
            ],
            true
        );

        // anchor controls to the octahedron
        const controls_octahedron = controlsManager.anchor(octahedronMesh, {
            hideOtherHandlesOnDrag: false,
            showHelperPlane: false
        });

        controls_octahedron.showAll(false);
        controls_octahedron.showByNames(
            [
            FreeformControls.DEFAULT_HANDLE_GROUP_NAME.PICK
            ],
            true
        );

        // anchor controls to the octahedron
        const controls_tetrahedron = controlsManager.anchor(tetrahedronMesh, {
            hideOtherHandlesOnDrag: false,
            showHelperPlane: false
        });

        controls_tetrahedron.showAll(false);
        controls_tetrahedron.showByNames(
            [
            FreeformControls.DEFAULT_HANDLE_GROUP_NAME.PICK
            ],
            true
        );        

        // disable orbit controls while the freeform-controls are in use
        controlsManager.listen(FreeformControls.EVENTS.DRAG_START, () => {
            orbitControls.enabled = false;
        });
        controlsManager.listen(FreeformControls.EVENTS.DRAG_STOP, () => {
            orbitControls.enabled = true;
        });

        function run(){
            var s = document.getElementById("dd");
            if(s.innerHTML == 0){
                window.location.href='regform.shtml';
                return false;
            }
            s.innerHTML = s.innerHTML * 1 - 1;
        }

        function start(){
            document.getElementById("timesum").disabled=true;
            document.getElementById("block").style.display="none";
            window.setInterval("run();", 1000);
        }
        
    </script>
</body>
</html>
